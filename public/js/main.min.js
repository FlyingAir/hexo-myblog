"use strict";!function(t,e){var i=e.body,s=e.querySelector.bind(e),n=e.querySelectorAll.bind(e),a=s("html"),o=s("#gotop"),r=s("#menu"),c=s("#main"),d=s("#header"),l=s("#mask"),h=s("#menu-toggle"),u=s("#menu-off"),f=s(".header-title"),v=s("#loading"),g=-1!==location.href.indexOf("post"),m=t.requestAnimationFrame,L=Array.prototype.forEach,p=/micromessenger/i.test(navigator.userAgent),w=function(){},y=function t(e){var i=e.offsetLeft,s=e.offsetTop;if(e.offsetParent){var n=t(e.offsetParent);i+=n.x,s+=n.y}return{x:i,y:s}},x="ontouchstart"in t&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent)?"touchstart":"click",E=e.documentElement;t.innerWidth>600?(window.navigator.userAgent.indexOf("WOW")>-1||window.navigator.userAgent.indexOf("Edge")>-1||window.navigator.userAgent.indexOf("MSIE")>-1)&&-1===window.navigator.userAgent.indexOf("Trident")&&(E=i):window.navigator.userAgent.indexOf("Android")>-1&&window.navigator.userAgent.indexOf("Browser")>-1&&(E=i);var $,T,O={goTop:function(t){var e=E.scrollTop,i=arguments.length>2?arguments[1]:Math.abs(e-t)/12;e&&e>t?(E.scrollTop=Math.max(e-i,0),m(arguments.callee.bind(this,t,i))):t&&e<t?(E.scrollTop=Math.min(e+i,t),m(arguments.callee.bind(this,t,i))):this.toc.actived(t)},toggleGotop:function(e){e>t.innerHeight/2?o.classList.add("in"):o.classList.remove("in")},toggleMenu:function(e){if(e){if(r.classList.remove("hide"),g||(c.classList.remove("menuoff"),jQuery(f).animate({marginRight:"-20%"})),t.innerWidth<1241)if(l.classList.add("in"),r.classList.add("show"),p){var i=E.scrollTop;c.classList.add("lock"),c.scrollTop=i}else a.classList.add("lock")}else if(l.classList.remove("in"),r.classList.remove("show"),p){var s=c.scrollTop;c.classList.remove("lock"),E.scrollTop=s}else a.classList.remove("lock")},fixedHeader:function(t){t>d.clientHeight?d.classList.add("fixed"):d.classList.remove("fixed")},toc:function(){var t=s("#post-toc");if(!t||!t.children.length)return g&&c.classList.add("show"),{fixed:w,actived:w};var e=s(".post-header").clientHeight,i=d.clientHeight,n=s("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");return t.querySelector('a[href="#'+n[0].id+'"]').parentNode.classList.add("active"),c.classList.add("tocshow"),f.classList.add("toc"),s(".footer").classList.add("toc"),{fixed:function(s){s>=e-i?t.classList.add("fixed"):t.classList.remove("fixed")},actived:function(e){for(var s=0,a=n.length;s<a;s++){if(e>y(n[s]).y-i-5)t.querySelector("li.active").classList.remove("active"),t.querySelector('a[href="#'+n[s].id+'"]').parentNode.classList.add("active")}e<y(n[0]).y&&(t.querySelector("li.active").classList.remove("active"),t.querySelector('a[href="#'+n[0].id+'"]').parentNode.classList.add("active"))}}}(),hideOnMask:[],modal:function(i){this.$modal=s(i),this.$off=this.$modal.querySelector(".close");var n=this;this.show=function(){l.classList.add("in"),t.innerWidth>800&&(c.classList.add("Mask"),r.classList.add("Mask")),n.$modal.classList.add("ready"),setTimeout(function(){n.$modal.classList.add("in")},0)},this.onHide=w,this.hide=function(){if(n.onHide(),l.classList.remove("in"),t.innerWidth>800){c.classList.remove("Mask"),r.classList.remove("Mask");var i=e.querySelector(".imgShow");i&&document.body.removeChild(i)}n.$modal.classList.remove("in"),setTimeout(function(){n.$modal.classList.remove("ready")},300)},this.toggle=function(){return n.$modal.classList.contains("in")?n.hide():n.show()},O.hideOnMask.push(this.hide),this.$off&&this.$off.addEventListener(x,this.hide)},share:function(){var t=s("#pageShare"),i=s("#shareFab"),a=new this.modal("#globalShare");i&&(i.addEventListener(x,function(){t.classList.toggle("in")},!1),e.addEventListener(x,function(e){i.contains(e.target)||t.classList.remove("in")},!1));var o=new this.modal("#wxShare");o.onHide=a.hide,L.call(n(".wxFab"),function(t){t.addEventListener(x,o.toggle)})},reward:function(){var t=new this.modal("#reward"),e=s("#rewardCode"),i=s("#rewardToggle"),n=!1,a=-1,o=s(".wechatPay"),r=s(".alipayPay"),c=s(".icon-caret-up");s("#rewardBtn").addEventListener(x,function(){-1===a?e.src=e.dataset.img:1===a?e.src=i.dataset.alipay:0===a&&(e.src=i.dataset.wechat),t.toggle()}),o.addEventListener("click",function(){n=!0}),i&&i.addEventListener("change",function(){this.checked?n?(e.src=this.dataset.wechat,r.classList.remove("show"),o.classList.add("show"),c.style="margin-left:-20%;",a=0):(e.src=this.dataset.alipay,r.classList.add("show"),o.classList.remove("show"),c.style="margin-left:20%;",this.checked=!1,a=1):(e.src=this.dataset.alipay,r.classList.add("show"),o.classList.remove("show"),c.style="margin-left:20%;",a=1)})},tabBar:function(t){t.parentNode.parentNode.classList.toggle("expand")},page:($=n(".fade, .fade-scale"),T=!1,{loaded:function(){L.call($,function(t){t.classList.add("in")}),T=!0},unload:function(){L.call($,function(t){t.classList.remove("in")}),T=!1},visible:T}),lightbox:function(){L.call(n(".img-lightbox"),function(s){new function(s){this.$img=s.querySelector("img"),this.$overlay=s.querySelector("overlay"),this.margin=40,this.title=this.$img.title||this.$img.alt||"",this.isZoom=!1;var n=void 0,a=void 0,o=void 0,r=void 0,c=void 0;this.calcRect=function(){r=i.clientWidth;var t=(c=i.clientHeight)-2*this.margin,e=n,s=a,d=(this.margin,e>r?r/e:1),l=s>t?t/s:1,h=Math.min(d,l);return{w:e*=h,h:s*=h,t:(c-s)/2-o.top,l:(r-e)/2-o.left+this.$img.offsetLeft}},this.setImgRect=function(t){this.$img.style.cssText="width: "+t.w+"px; max-width: "+t.w+"px; height:"+t.h+"px; top: "+t.t+"px; left: "+t.l+"px"},this.setFrom=function(){this.setImgRect({w:o.width,h:o.height,t:0,l:(s.offsetWidth-o.width)/2})},this.setTo=function(){this.setImgRect(this.calcRect())},this.addTitle=function(){this.title&&(this.$caption=e.createElement("div"),this.$caption.innerHTML=this.title,this.$caption.className="overlay-title",s.appendChild(this.$caption))},this.removeTitle=function(){this.$caption&&s.removeChild(this.$caption)};var d=this;this.zoomIn=function(){n=this.$img.naturalWidth||this.$img.width,a=this.$img.naturalHeight||this.$img.height,o=this.$img.getBoundingClientRect(),s.style.height=o.height+"px",s.classList.add("ready"),this.setFrom(),this.addTitle(),this.$img.classList.add("zoom-in"),setTimeout(function(){s.classList.add("active"),d.setTo(),d.isZoom=!0},0)},this.zoomOut=function(){this.isZoom=!1,s.classList.remove("active"),this.$img.classList.add("zoom-in"),this.setFrom(),setTimeout(function(){d.$img.classList.remove("zoom-in"),d.$img.style.cssText="",d.removeTitle(),s.classList.remove("ready"),s.removeAttribute("style")},300)},s.addEventListener("click",function(t){d.isZoom?d.zoomOut():"IMG"===t.target.tagName&&d.zoomIn()}),e.addEventListener("scroll",function(){d.isZoom&&d.zoomOut()}),t.addEventListener("resize",function(){d.isZoom&&d.zoomOut()})}(s)})}(),loadScript:function(t){t.forEach(function(t){var s=e.createElement("script");s.src=t,s.async=!0,i.appendChild(s)})}};t.addEventListener("load",function(){v.classList.remove("active"),O.page.loaded(),t.lazyScripts&&t.lazyScripts.length&&O.loadScript(t.lazyScripts)}),t.addEventListener("DOMContentLoaded",function(){var t=E.scrollTop;O.toc.fixed(t),O.toc.actived(t),O.page.loaded()});var k=!1,S=s('a[href^="mailto"]');S&&S.addEventListener(x,function(){k=!0}),t.addEventListener("beforeunload",function(){k?k=!1:O.page.unload()}),t.addEventListener("pageshow",function(){O.page.visible||O.page.loaded()}),t.addEventListener("resize",function(){x="ontouchstart"in t?"touchstart":"click",t.BLOG.even=x,O.toggleMenu()}),o.addEventListener(x,function(){m(O.goTop.bind(O,0))},!1),h.addEventListener(x,function(t){O.toggleMenu(!0),t.preventDefault()},!1),u.addEventListener(x,function(){r.classList.add("hide"),g||(c.classList.add("menuoff"),jQuery(f).animate({marginRight:"-3%"}))},!1),l.addEventListener(x,function(t){O.toggleMenu(),O.hideOnMask.forEach(function(t){t()}),t.preventDefault()},!1),e.addEventListener("scroll",function(){var t=E.scrollTop;O.toggleGotop(t),O.fixedHeader(t),O.toc.fixed(t),O.toc.actived(t)},!1),t.BLOG.SHARE&&g&&O.share(),t.BLOG.REWARD&&O.reward(),O.noop=w,O.even=x,O.$=s,O.$$=n,Object.keys(O).reduce(function(t,e){return t[e]=O[e],t},t.BLOG),t.Waves?(Waves.init(),Waves.attach(".global-share li",["waves-block"]),Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])):console.error("Waves loading failed.")}(window,document),function(){var t=window||this,e=t.BLOG.even,i=t.BLOG.$,s=i("#search"),n=i("#search-wrap"),a=i("#key"),o=i("#back"),r=i("#search-panel"),c=i("#search-result"),d=i("#search-tpl").innerHTML,l=(t.BLOG.ROOT+"/content.json").replace(/\/{2}/g,"/"),h=void 0;var u=i("html"),f={show:function(){t.innerWidth<760&&u.classList.add("lock-size"),r.classList.add("in")},hide:function(){t.innerWidth<760&&u.classList.remove("lock-size"),r.classList.remove("in")}};function v(t,e){return e.lastIndex=0,e.test(t)}function g(e){var i=this.value.trim();if(i){var s=new RegExp(i.replace(/[ ]/g,"|"),"gmi");!function(t){if(h)t(h);else{var e=new XMLHttpRequest;e.open("GET",l,!0),e.onload=function(){if(this.status>=200&&this.status<300){var e=JSON.parse(this.response);h=e instanceof Array?e:e.posts,t(h)}else console.error(this.statusText)},e.onerror=function(){console.error(this.statusText)},e.send()}}(function(e){var i,n,a=e.filter(function(t){return i=s,v((e=t).title,i)||e.tags.some(function(t){return v(t.name,i)})||v(e.text,i);var e,i});n="",n=(i=a).length?i.map(function(e){return i=d,s={title:e.title,path:(t.BLOG.ROOT+"/"+e.path).replace(/\/{2,}/g,"/"),date:new Date(e.date).toLocaleDateString(),tags:e.tags.map(function(t){return"<span>#"+t.name+"</span>"}).join("")},i.replace(/\{\w+\}/g,function(t){var e=t.replace(/\{|\}/g,"");return s[e]||""});var i,s}).join(""):'<li class="tips"><i class="icon icon-coffee icon-3x"></i><p>Results not found!</p></li>',c.innerHTML=n,f.show()}),e.preventDefault()}}s.addEventListener(e,function(){n.classList.toggle("in"),a.value="",n.classList.contains("in")?a.focus():a.blur()}),o.addEventListener(e,function(){n.classList.remove("in"),f.hide()}),document.addEventListener(e,function(t){"key"!==t.target.id&&"click"===e&&f.hide()}),a.addEventListener("input",g),a.addEventListener(e,g)}.call(void 0);